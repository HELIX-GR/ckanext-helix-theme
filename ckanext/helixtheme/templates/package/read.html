{% ckan_extends %}

{% set pkg = c.pkg_dict %}

{% if pkg %} 
    {% if pkg.organization %}
        {% set org = h.get_organization(pkg.organization.name) %}
        {% do pkg.update(organization = org) %} 
    {% endif %}
{% endif %}

{% block toolbar %}
{{ super() }}
{% endblock %}

{# fix for organization and group title non translation in sidebar #}
{% do h.get_translated_dataset_groups([c.pkg_dict]) %}


{% block breadcrumb_content %}
  {% if pkg %}
    {% set dataset = pkg.title or pkg.name %}
    {% if pkg.organization %}

      <a class="breadcrumbs-part" {% link_for _('Organizations'), controller='organization', action='index' %}</a>
      <a class="breadcrumbs-part" {% link_for org.title|truncate(30) or org.name, controller='organization', action='read', id=pkg.organization.name %}</a>
    {% else %}
      <a class="breadcrumbs-part" {% link_for _('Datasets'), controller='package', action='search' %}</a>
    {% endif %}
    <a class="breadcrumbs-part"{{ self.breadcrumb_content_selected() }}{% link_for dataset|truncate(30), controller='package', action='read', id=pkg.name %}</a>
  {% else %}
    <a class="breadcrumbs-part" {% link_for _('Datasets'), controller='package', action='search' %}</a>
    <a class="breadcrumbs-part" href=""{{ _('Create Dataset') }}</a>
  {% endif %}
{% endblock %}

{% block page_heading %}
{{ super() }}
{% endblock %}

{% block content_action %}
    {% if h.check_access('package_update', {'id':pkg.id }) %}
    {% link_for _('Manage'), controller='package', action='edit', id=pkg.name, class_='btn btn-default btn-manage', icon='wrench' %}
  {% endif %}
{% endblock %}

{% block package_notes %}
    {% block package_dates %}
    <div class="dataset-dates">
    <div> {{_('Publication:')}} {{ pkg.metadata_created.split('T')[0] or pkg.metadata_created or _('Never')}}</div>
    <div> {{_('Last revision:')}} {{ pkg.metadata_modified.split('T')[0] or pkg.metadata_modified or  _('Never') }}</div>
</div>
{% endblock %}
<hr class="border-divider"/>

{{ super() }}
<hr class="border-divider"/>
{% endblock %}

{% block package_tags %}{% endblock %}
  
    {% block dataset_type %}
  {% set api_controller = 'ckanext.publicamundi.controllers.api:Controller' %}
  {% endblock %}


{% block package_additional_info %}
<hr class="border-divider"/>
{{ super() }}
{% endblock %}

 {% block secondary_content %}
    {% if pkg.organization %}
    {% block package_organization %}
        {% snippet "snippets/organization.html", organization=org, pkg=pkg, has_context_title=true  %}
    {% endblock %}
    {% endif %}   
    
    {% if pkg.groups %}
    {% block package_group %}
        {% snippet "snippets/group.html", group=pkg.groups %}
    {% endblock %}
    {% endif %}

    {% if pkg.closed_tag %}
        {% snippet "package/snippets/closed_tags.html", tags=pkg.closed_tag %}
    {% endif %}  
    

    {% if pkg.tags %}
    {% block package_side_tags %}
        {% snippet "package/snippets/tags.html", tags=pkg.tags %}
    {% endblock %}
    {% endif %}
    
    
    {% if pkg.spatial %}
        {% snippet "spatial/snippets/dataset_map_sidebar.html", extent=pkg.spatial %}
    {% endif %}


    {% block package_license %}
        {% snippet "snippets/license.html", pkg_dict=pkg %}
    {% endblock %}

    {# {% block package_developers %}
        {% snippet "snippets/developers.html", pkg_dict=pkg %}
    {% endblock %} 
    #}
    {#{% block package_social %}
        {% snippet "snippets/social.html" %}
    {% endblock %} #} 

{% endblock %}
